{% extends 'base.html' %}

{% block content %}
{% if request.user.student %}
    <div class="content">
        <!-- Open menu on click -->
				<div class="card">
					<div class="card-header header-elements-inline">
						<h5 class="card-title">Open menu on click</h5>
						<div class="header-elements">
							<div class="list-icons">
		                		<a class="list-icons-item" data-action="collapse"></a>
		                		<a class="list-icons-item" data-action="reload"></a>
								<button id="submit" class="btn btn-primary">Скачать файл</button>
		                	</div>
	                	</div>
					</div>

					<div class="table-responsive">
						<table class="table table-hover">
							<thead>
								<tr>
									<th>#</th>
									<th>Предмет</th>
									<th>Учитель</th>
                                    <th>Задача</th>
									<th>Оценка</th>
								</tr>
							</thead>
							<tbody>
                            {% for el in ratings %}
								<tr>
									<td>{{ forloop.counter }}</td>
									<td>{{ el.homework.teacher.position }}</td>
									<td>{{ el.homework.teacher.user.first_name }}  {{ el.homework.teacher.user.last_name }}</td>
                                    <td>{{ el.homework.homework_title }}</td>
                                    {% if el.submission_rating %}
									<td>{{ el.submission_rating }}</td>
                                    {% else %}
                                    <td></td>
                                    {% endif %}
								</tr>
                            {% endfor %}
							</tbody>
						</table>
					</div>
				</div>
				<!-- /open menu on click -->
    </div>
	<!-- Success modal -->
	<div id="modal_theme_success" class="modal fade" tabindex="-1">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header bg-success">
					<h6 class="modal-title">Success header</h6>
					<button type="button" class="close" data-dismiss="modal">&times;</button>
				</div>

				<div class="modal-body">
					<h6 class="font-weight-semibold">Оценки</h6>
					<a href="" target="_blank" id="fileRating">Скачать файл</a>
				</div>
			</div>
		</div>
	</div>
	<!-- /success modal -->
	<script>
	$('#submit').on('click', function(){
		$.ajax({
			type:'GET',
			url:'http://127.0.0.1:8000/api/v1/user/student/file/rating/',
			success: function(data){
				$('#modal_theme_success').modal();
				$('#fileRating')[0].href = data.file_ratings
			},
			error: function(data){
				new PNotify({
					title: 'Предупреждающее уведомление',
					text: data['responseJSON']['msg'],
					addclass: 'bg-danger border-danger'
				});
			}
		});
	});
	</script>
{% endif %}
{% endblock %}